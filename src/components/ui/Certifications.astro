---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import { getImage } from 'astro:assets';

// Get certifications from content collection
const certifications = await getCollection('certifications');
const sortedCertifications = certifications.sort(
    (a, b) => a.data.order - b.data.order
);

// Import scrum logo
import scrumLogo from '@/assets/images/logos/scrum-org-logo.svg';

// Helper function to get icon image
async function getIconImage(iconPath: string) {
    if (iconPath.startsWith('http')) {
        return { src: iconPath };
    } else {
        let logoModule;
        switch (iconPath) {
            case 'scrum-org-logo.svg':
                logoModule = { default: scrumLogo };
                break;
            default:
                try {
                    logoModule = await import(
                        `@/assets/images/logos/${iconPath}`
                    );
                } catch (error) {
                    console.warn(`Could not import logo: ${iconPath}`);
                    return { src: '' };
                }
        }
        return await getImage({ src: logoModule.default, format: 'avif' });
    }
}
---

<div class="flex flex-col gap-6">
    <h2 class="text-headings text-lg font-semibold">Certifications</h2>

    <div class="flex flex-wrap gap-3">
        {
            sortedCertifications.map(async (certification) => {
                const iconImage = await getIconImage(certification.data.icon);

                return (
                    <div class="flex items-center gap-2 bg-muted-foreground/20 px-3 py-2 rounded-lg hover:bg-muted-foreground/30 transition-colors">
                        {iconImage.src.startsWith('http') ? (
                            <img
                                src={iconImage.src}
                                alt={certification.data.name}
                                class="w-5 h-5"
                            />
                        ) : (
                            <Image
                                src={iconImage.src}
                                alt={certification.data.name}
                                width={20}
                                height={20}
                                class="w-5 h-5"
                            />
                        )}
                        <span class="text-sm">{certification.data.name}</span>
                    </div>
                );
            })
        }
    </div>
</div>
