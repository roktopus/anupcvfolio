---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import { getImage } from 'astro:assets';

// Get companies from content collection
const companies = await getCollection('companies');
const sortedCompanies = companies.sort((a, b) => a.data.order - b.data.order);

// Import all company logos at the top
import vpixLogo from '@/assets/images/logos/vpix-logo.svg';
import zolidarLogo from '@/assets/images/logos/zolidar-logo.svg';
import vertivLogo from '@/assets/images/logos/vertiv-logo.svg';
import onwardLogo from '@/assets/images/logos/onward-logo.svg';
import infosysLogo from '@/assets/images/logos/infosys-logo.png';
import wiproLogo from '@/assets/images/logos/wipro-logo.svg';
import emersonLogo from '@/assets/images/logos/emerson-logo.svg';

// Helper function to get logo image
async function getLogoImage(logoPath: string) {
    let logoModule;
    switch (logoPath) {
        case 'vpix-logo.svg':
            logoModule = { default: vpixLogo };
            break;
        case 'zolidar-logo.svg':
            logoModule = { default: zolidarLogo };
            break;
        case 'vertiv-logo.svg':
            logoModule = { default: vertivLogo };
            break;
        case 'onward-logo.svg':
            logoModule = { default: onwardLogo };
            break;
        case 'infosys-logo.png':
            logoModule = { default: infosysLogo };
            break;
        case 'wipro-logo.svg':
            logoModule = { default: wiproLogo };
            break;
        case 'emerson-logo.svg':
            logoModule = { default: emersonLogo };
            break;
        default:
            try {
                logoModule = await import(`@/assets/images/logos/${logoPath}`);
            } catch (error) {
                console.warn(`Could not import logo: ${logoPath}`);
                return { src: '' };
            }
    }
    return await getImage({ src: logoModule.default, format: 'avif' });
}
---

<div class="flex flex-col gap-6">
    <h2 class="text-headings text-lg font-semibold">
        Companies I've Worked With
    </h2>

    <div class="flex flex-wrap gap-4">
        {
            sortedCompanies.map(async (company) => {
                const logoImage = await getLogoImage(company.data.logo);
                return (
                    <a
                        href={company.data.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex items-center gap-3 bg-muted-foreground/20 px-4 py-3 rounded-lg hover:bg-muted-foreground/30 transition-colors"
                    >
                        <Image
                            src={logoImage.src}
                            alt={`${company.data.name} Logo`}
                            width={32}
                            height={32}
                            class="w-8 h-8"
                        />
                        <span class="text-sm font-medium">
                            {company.data.name}
                        </span>
                    </a>
                );
            })
        }
    </div>
</div>
